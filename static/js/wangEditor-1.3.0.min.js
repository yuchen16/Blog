/*! wangEditor-1.3.0.js 2015-07-09 */
!function(a){"function"==typeof define&&define.amd?define("wangEditor",["jquery"],a):a(window.jQuery)}(function(a){var b,c=!1,d=!1,e=!1;if("Microsoft Internet Explorer"===navigator.appName&&(b=navigator.appVersion.split(";")[1].replace(/[ ]/g,""),c="MSIE6.0"===b,d="MSIE7.0"===b,e="MSIE8.0"===b),(c||d||e)&&(window.onload=function(){function b(a,b){a.className="",a.innerHTML="<span style=\"font-family: 'icomoon'\">"+b+"</span>"}var c={"icon-wangEditor-link":"&#xe800;","icon-wangEditor-unlink":"&#xe801;","icon-wangEditor-code":"&#xe802;","icon-wangEditor-cancel":"&#xe803;","icon-wangEditor-terminal":"&#xe804;","icon-wangEditor-angle-down":"&#xe805;","icon-wangEditor-font":"&#xe806;","icon-wangEditor-bold":"&#xe807;","icon-wangEditor-italic":"&#xe808;","icon-wangEditor-header":"&#xe809;","icon-wangEditor-align-left":"&#xe80a;","icon-wangEditor-align-center":"&#xe80b;","icon-wangEditor-align-right":"&#xe80c;","icon-wangEditor-list-bullet":"&#xe80d;","icon-wangEditor-indent-left":"&#xe80e;","icon-wangEditor-indent-right":"&#xe80f;","icon-wangEditor-list-numbered":"&#xe810;","icon-wangEditor-underline":"&#xe811;","icon-wangEditor-table":"&#xe812;","icon-wangEditor-eraser":"&#xe813;","icon-wangEditor-text-height":"&#xe814;","icon-wangEditor-brush":"&#xe815;","icon-wangEditor-pencil":"&#xe816;","icon-wangEditor-minus":"&#xe817;","icon-wangEditor-picture":"&#xe818;","icon-wangEditor-file-image":"&#xe819;","icon-wangEditor-cw":"&#xe81a;","icon-wangEditor-ccw":"&#xe81b;","icon-wangEditor-music":"&#xe911;","icon-wangEditor-play":"&#xe912;","icon-wangEditor-location":"&#xe947;","icon-wangEditor-happy":"&#xe9df;","icon-wangEditor-sigma":"&#xea67","icon-wangEditor-enlarge2":"&#xe98b;","icon-wangEditor-shrink2":"&#xe98c","icon-wangEditor-newspaper":"&#xe904","icon-wangEditor-camera":"&#xe90f","icon-wangEditor-video-camera":"&#xe914","icon-wangEditor-file-zip":"&#xe92b","icon-wangEditor-stack":"&#xe92e","icon-wangEditor-credit-card":"&#xe93f","icon-wangEditor-address-book":"&#xe944","icon-wangEditor-envelop":"&#xe945","icon-wangEditor-drawer":"&#xe95c","icon-wangEditor-download":"&#xe960","icon-wangEditor-upload":"&#xe961","icon-wangEditor-lock":"&#xe98f","icon-wangEditor-unlocked":"&#xe990","icon-wangEditor-wrench":"&#xe991","icon-wangEditor-eye":"&#xe9ce","icon-wangEditor-eye-blocked":"&#xe9d1","icon-wangEditor-command":"&#xea4e","icon-wangEditor-font2":"&#xea5c","icon-wangEditor-libreoffice":"&#xeade"};a(".wangEditor-container i").each(function(){var a=this,d=this.className,e=d.match(/icon-wangEditor-[^\s'"]+/);e&&b(a,c[e[0]])})}),!a)return void alert("检测到页面没有引用jQuery，请先引用，否则wangEditor将无法使用。");if("function"!=typeof a||/^\d+\.\d+\.\d+$/.test(a().jquery)===!1)return void alert("检测到 window.jQuery 已被修改，wangEditor无法使用。");window.wangEditorData={};var f=window.document,g=a(f),h=(a(window),a("body"),"function"==typeof f.createRange),i=!!window.ActiveXObject||"ActiveXObject"in window,j=navigator.userAgent.indexOf("Firefox")>0,k="wangeditor_"+Math.random().toString().replace(".","")+"_",l=1,m=10,n=["<",">","(",")"],o=function(a,b){return new o.fn.init(a,b)};o.fn=o.prototype,a.extend(o,{consoleLog:function(a){window.console&&window.console.log&&"function"==typeof window.console.log&&window.console.log("wangEditor提示：",a)},getUniqeId:function(){return k+l++},filterXSSForUrl:function(b){var c=!0;return a.each(n,function(a,d){b.indexOf(d)>=0&&(c=!1)}),c},replaceQuotes:function(a){if(""===a)return a;var b=a.replace(/\n/gm,"");return b=b.replace(/(<.*?>)|(')|(")/gm,function(a,b,c,d){return b?b:c?"&#39;":d?"&quot;":void 0})},showTableBorder:function(b){b.find("table").each(function(){var b=a(this),c="wangEditor_table_border_mark",d=b.attr(c);d||(b.attr("border","1"),b.attr("bordercolor","#cccccc"),b.attr("cellpadding","0"),b.attr("cellspacing","0"),b.css({"border-collapse":"collapse"}),b.find("tr").first().find("td").css({"min-width":"100px"}),b.attr(c,"1"))})}}),a.extend(o,{styleConfig:{fontFamilyOptions:["宋体","黑体","楷体","隶书","幼圆","微软雅黑","Arial","Verdana","Georgia","Times New Roman","Trebuchet MS","Courier New","Impact","Comic Sans MS"],colorOptions:{"#880000":"暗红色","#800080":"紫色","#ff0000":"红色","#ff00ff":"鲜粉色","#000080":"深蓝色","#0000ff":"蓝色","#00ffff":"湖蓝色","#008080":"蓝绿色","#008000":"绿色","#808000":"橄榄色","#00ff00":"浅绿色","#ffcc00":"橙黄色","#808080":"灰色","#c0c0c0":"银色","#000000":"黑色","#ffffff":"白色"},fontsizeOptions:{1:"10px",2:"13px",3:"16px",4:"19px",5:"22px",6:"25px",7:"28px"}},htmlTemplates:{elemDeleteBtn:'<a href="#" class="wangEditor-elemDeleteBtn"><i class="icon-wangEditor-cancel"></i></a>',imgResizeBtn:'<div class="wangEditor-imgResize"></div>',editorContainer:'<div class="wangEditor-container"></div>',btnContainer:'<div class="wangEditor-btn-container clearfix"></div>',btnContainerGroup:'<div class="wangEditor-btn-container-group"></div>',btn:'<a class="wangEditor-btn-container-btn wangEditor-btn-container-btn-default" href="#"></a>',btnAngleDown:'<i class="icon-wangEditor-angle-down"></i>',tooltip:'<div class="wangEditor-toolTip"></div>',tooltipContent:'<div class="wangEditor-toolTip-content">{title}</div>',modalContainer:'<div class="wangEditor-modal-container"></div>',modal:'<div class="wangEditor-modal">{content}</div>',modalBig:'<div class="wangEditor-modal wangEditor-modal-big">{content}</div>',modalSmall:'<div class="wangEditor-modal wangEditor-modal-small">{content}</div>',modalMini:'<div class="wangEditor-modal wangEditor-modal-mini">{content}</div>',modalHeader:'<div class="wangEditor-modal-header"><a href="#" commandName="close" class="wangEditor-modal-header-close"><i class="icon-wangEditor-cancel"></i></a><b>{title}</b><div class="wangEditor-modal-header-line"></div></div>',txtContainer:'<div class="wangEditor-textarea-container"></div>',txt:'<div class="wangEditor-textarea" contenteditable="true"><p><br/></p></div>',dropMenu:'<ul class="wangEditor-drop-menu">{content}</ul>',dropPanel:'<ul class="wangEditor-drop-panel">{content}</ul>',dropPanelBig:'<ul class="wangEditor-drop-panel wangEditor-drop-panel-big">{content}</ul>',dropPanel_floatItem:'<div class="wangEditor-drop-panel-floatItem">{content}</div>',videoEmbed:'<embed src="{src}" allowFullScreen="true" quality="high" width="{width}" height="{height}" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash"></embed>',codePre:'<pre style="border:1px solid #ccc; background-color: #f5f5f5; padding: 10px; margin: 5px 0px; line-height: 1.4; font-size: 0.8em; font-family: Menlo, Monaco, Consolas; border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px;">{content}</pre><p><br></p>'},expressionConfig:{path:"http://www.wangeditor.com/expressions/",fileNames:[1,100],ext:".gif"}}),window.wangEditorData.htmlTemplates=o.htmlTemplates,a.extend(o,{commandEnabled:function(a){var b;try{b=f.queryCommandEnabled(a)}catch(c){b=!1}return b},getElemForInsertTable:function(b){return"body"!==b[0].nodeName.toLowerCase()?b.parent().is('div[contenteditable="true"]')?b:b.is('div[contenteditable="true"]')?(0===b.children().length&&b.append(a("<p></p>")),b.children().last()):this.getElemForInsertTable(b.parent()):void 0}}),a.extend(o,{createMenuGroup:function(b,c){if(b instanceof Array!=!1){var d=a(o.htmlTemplates.btnContainerGroup);a.each(b,function(b,e){var f=o.createMenu(e,c);f instanceof Array?a.each(f,function(a,b){d.append(b)}):d.append(f)}),c.insertMenuGroup(d)}},createMenu:function(b,c){if(null!=b&&(b=a.trim(b.toString()),b=c.menus[b])){var d=b.dependence,e=b.dependenceAlert;if("dependence"in b&&null==d)return void o.consoleLog(e);var f,g,h,i,j,k,l=b.title,m=b.type,n=b.cssClass,p=b.style,q=b.command,r=b.hotKey,s=[],t=b.dropMenu&&b.dropMenu(),u=b.dropPanel&&b.dropPanel(c),v=b.modal&&b.modal(c),w=b.callback,x=a(o.htmlTemplates.btn),y=[x];if("string"==typeof q&&(q=a.trim(q)),f=p?'<i class="'+n+'" style="'+p+'"></i>':'<i class="'+n+'"></i>',x.html(f),l&&x.attr("title",l),"btn"===m?("string"==typeof q&&x.attr("commandName",q),"string"==typeof q&&x.click(function(a){c.hideModal(),c.command(a,q,void 0,w),a.stopPropagation()}),"function"==typeof q&&x.click(function(a){c.hideModal(),q(a),a.stopPropagation()}),r&&(r=r.toLowerCase(),g=a.trim(r.split("+")[1]),s=r.split("+")[0].split(","),a.each(s,function(b,c){s[b]=a.trim(c)}),h=function(b){var c=!0;return a.each(["ctrl","shift","alt","meta"],function(a,d){-1===s.indexOf(d)||b[d+"Key"]?-1===s.indexOf(d)&&b[d+"Key"]&&(c=!1):c=!1}),c},c.bindEventFor$txt("keydown",function(a){h(a)!==!1&&String.fromCharCode(a.keyCode).toLowerCase()===g&&(a.preventDefault(),x.click())}))):"dropMenu"===m?(x.append(a(o.htmlTemplates.btnAngleDown)),y.unshift(t),i=function(){t.hide()},x.click(function(a){c.hideModal(),t.css("display","inline-block"),a.preventDefault(),this.focus(),a.stopPropagation()}).blur(function(a){setTimeout(i,200)}),t.on("click","a[commandValue]",function(b){var d=a(this),e=d.attr("commandValue");c.command(b,q,e,w)}),i()):"dropPanel"===m?(y.unshift(u),j=function(){u.hide()},x.click(function(a){c.hideModal(),u.css("display","inline-block"),a.preventDefault(),this.focus(),a.stopPropagation()}).blur(function(a){setTimeout(j,200)}),u.on("click","a[commandValue]",function(b){var d=a(this),e=d.attr("commandValue");c.command(b,q,e,w)}),j()):"modal"===m&&(v.prepend(a(o.htmlTemplates.modalHeader.replace("{title}",l))),c.insertModal(v),x.click(function(a){c.hideModal(),v.css("margin-left",c.$editorContainer.outerWidth()/2-v.outerWidth()/2),v.show(),a.preventDefault(),a.stopPropagation()}),v.find("[commandName=close]").click(function(a){v.hide(),a.preventDefault()})),l){x.attr("title",""),r&&(l=l+"("+r+")");var z,A,B=a(o.htmlTemplates.tooltip),C=a(o.htmlTemplates.tooltipContent.replace("{title}",l));B.append(C),y.unshift(B),k=function(){B.css("display","inline-block")},x.mouseenter(function(){A||(A=B.css("margin-left")),"0px"===A&&(A=0-(B.outerWidth()/2-x.outerWidth()/2)+"px",B.css("margin-left",A)),z=setTimeout(k,200)}).mouseleave(function(){clearTimeout(z),B.hide()})}return y}}}),a.extend(o.fn,{init:function(b,c){function d(a){l.saveSelection(),l.updateMenuStyle(),a&&"focus"===a.type&&l.$txt.off("focus",d)}var e=c.onchange,f=c.menuConfig,g=c.expressions,h=c.uploadUrl,k=c.extendedMenus,l=this,m=b.height(),n=a.trim(b.val()),p=b.attr("id");return p||(p=o.getUniqeId()),l.id=p,l.$editorContainer=a(o.htmlTemplates.editorContainer),l.$btnContainer=a(o.htmlTemplates.btnContainer),l.$modalContainer=a(o.htmlTemplates.modalContainer),l.$txtContainer=a(o.htmlTemplates.txtContainer),l.$txt=a(o.htmlTemplates.txt),l.$textarea=b,l.$elemDeleteBtn=a(o.htmlTemplates.elemDeleteBtn),l.$imgResizeBtn=a(o.htmlTemplates.imgResizeBtn),l.$txtContainer.append(l.$txt),l.$editorContainer.append(l.$btnContainer).append(l.$modalContainer).append(l.$txtContainer).append(l.$elemDeleteBtn).append(l.$imgResizeBtn),n&&l.$txt.html(n),80>=m&&(m=80),a(function(){var a=m-l.$btnContainer.outerHeight();a-=2,0>=a&&(a=m-32),l.$txtContainer.height(a),l.$txt.css("min-height",a-10+"px")}),e&&"function"==typeof e&&(l.onchange=e),h&&"string"==typeof h&&(l.uploadUrl=h),g&&g.length&&g.length>0&&(l.expressions=g),l.initMenus(),k&&a.extend(l.menus,k),f&&f instanceof Array==!0&&f[0]instanceof Array==!0&&(l.editorMenuConfig=f),a.each(l.editorMenuConfig,function(a,b){o.createMenuGroup(b,l)}),l.$txt.on("focus",d).on("mousedown",function(){l.$txt.on("mouseleave",function(){l.$txt.off("mouseleave"),setTimeout(d,100)})}).on("click keyup",function(a){var b=!1,c=[33,34,35,36,37,38,39,40,13,8,46,9,65];b="click"===a.type||"keyup"===a.type&&-1!==c.indexOf(a.keyCode)||a.ctrlKey||a.shiftKey||a.metaKey,b&&(d(),"click"===a.type&&l.$txt.off("mouseleave"))}).on("focus blur",function(){l.addCommandRecord()}),l.initDeleteBtn(i||j?"table":"img,table"),i||j||l.initImgResizeBtn("img"),l.$txtContainer.click(function(){l.hideModal()}),l.$btnContainer.click(function(){l.hideModal()}),l._initCommandRecord(),l.latestHtml=l.html(),l.$txt.blur(function(){l.change()}),l.$txt.focus(),l},insertMenuGroup:function(a){this.$btnContainer.append(a)},insertModal:function(a){this.$modalContainer.append(a)},bindEventFor$txt:function(a,b){this.$txt.on(a,b)},initDeleteBtn:function(b){function c(){var a=f.css("display");""!==a&&"none"!==a&&f.hide(),d=""}var d,e=this,f=e.$elemDeleteBtn;e.$txt.on("click",b,function(b){var g=a(this),h=g.data("deleteBtnId"),i=o.getUniqeId();if(h&&d===h)return void b.stopPropagation();h||(g.data("deleteBtnId",i),h=i),d=h;var j=e.$btnContainer.position().top,k=e.$btnContainer.outerHeight(),l=g.position(),m=l.top,n=l.left,p=f.width(),q=f.height();j+k>=m||(f.css({top:m-q/2+"px",left:n-p/2+"px"}),f.show(),e.$txtContainer.off("scroll.deleteBtn"),e.$txtContainer.on("scroll.deleteBtn",c),f.off(),f.click(function(a){e.command(a,"delete$elem",g,c)}),b.stopPropagation(),b.preventDefault())}),e.$txt.on("click keyup blur",function(a){"blur"===a.type?setTimeout(c,100):c()})},initImgResizeBtn:function(b){function c(){if(!h){var a=f.css("display");""!==a&&"none"!==a&&f.hide(),d=""}}var d,e=this,f=e.$imgResizeBtn,h=!1;e.$txt.on("click",b,function(b){var i=a(this),j=i.data("imgResizeId"),k=o.getUniqeId();if(j&&d===j)return void b.stopPropagation();j||(i.data("imgResizeId",k),j=k),d=j;var l,m,n,p,q=i.position(),r=q.top,s=q.left,t=i.outerWidth(),u=i.outerHeight(),v=e.$txtContainer.position(),w=v.top,x=v.left,y=e.$txtContainer.outerWidth(),z=e.$txtContainer.outerHeight(),A=f.outerWidth(),B=f.outerHeight(),C=e.$editorContainer.position(),D=C.left,E=C.top;r+u>w+z||s+t>x+y||(f.css({top:r+u-B+"px",left:s+t-A+"px"}),f.show(),e.$txtContainer.off("scroll.resizebtn"),e.$txtContainer.on("scroll.resizebtn",c),f.off(),f.on("mousedown",function(a){h=!0;var b=f.position();n=a.pageX-D-b.left,p=a.pageY-E-b.top,l=f.outerWidth(),m=f.outerHeight()}),g.off("mousemove.resizeBtn mouseup.resizeBtn"),g.on("mousemove.resizeBtn",function(a){if(h){var b=a.pageX-D-n,c=a.pageY-E-p;f.css({top:c,left:b});var d=f.position(),e=d.left,g=d.top;i.css({width:e+l-s,height:g+m-r}),a.preventDefault()}}).on("mouseup.resizeBtn",function(a){h=!1}),b.stopPropagation(),b.preventDefault())}),e.$txt.on("click keyup blur",function(a){"blur"===a.type?setTimeout(c,100):c()})},html:function(a){return null==a?this.$txt.html():void("string"==typeof a&&(this.$txt.html(a),this.change()))},text:function(){return this.$txt.text()},append:function(b){null!=b&&("string"==typeof b&&(b="<div>"+b+"</div>",this.$txt.append(a(b))),b instanceof a&&this.$txt.append(b),this.change())},textareaVal:function(a){return a||""===a?void this.$textarea.val(a):this.$textarea.val()},hideModal:function(){this.$modalContainer.find(".wangEditor-modal:visible").hide()},getEditorContainer:function(){return this.$editorContainer}}),o.fn.init.prototype=o.fn,a.extend(o.fn,{initMenus:function(){this.menus={fontFamily:{title:"字体",type:"dropMenu",cssClass:"icon-wangEditor-font2",command:"fontName ",dropMenu:function(){var b,c=[],d='<li><a href="#" commandValue="${value}" style="font-family:${family};">${txt}</a></li>';return a.each(o.styleConfig.fontFamilyOptions,function(a,b){c.push(d.replace("${value}",b).replace("${family}",b).replace("${txt}",b))}),b=a(o.htmlTemplates.dropMenu.replace("{content}",c.join("")))},callback:function(a){}},fontSize:{title:"字号",type:"dropMenu",cssClass:"icon-wangEditor-text-height",command:"fontSize",dropMenu:function(){var b,c=[],d='<li><a href="#" commandValue="${value}" style="font-size:${fontsize};">${txt}</a></li>';return a.each(o.styleConfig.fontsizeOptions,function(a,b){c.push(d.replace("${value}",a).replace("${fontsize}",b).replace("${txt}",b))}),b=a(o.htmlTemplates.dropMenu.replace("{content}",c.join("")))}},bold:{title:"加粗",type:"btn",hotKey:"ctrl + b",cssClass:"icon-wangEditor-bold",command:"bold",callback:function(a){}},underline:{title:"下划线",type:"btn",hotKey:"ctrl + u",cssClass:"icon-wangEditor-underline",command:"underline "},italic:{title:"斜体",type:"btn",hotKey:"ctrl + i",cssClass:"icon-wangEditor-italic",command:"italic "},setHead:{title:"设置标题",type:"dropMenu",cssClass:"icon-wangEditor-header",command:"formatBlock ",dropMenu:function(){var b='<li><a href="#" commandValue="<h1>"><h1>标题1</h1></a></li><li><a href="#" commandValue="<h2>"><h2>标题2</h2></a></li><li><a href="#" commandValue="<h3>"><h3>标题3</h3></a></li><li><a href="#" commandValue="<h4>"><h4>标题4</h4></a></li><li><a href="#" commandValue="<p>">正文</a></li>';return a(o.htmlTemplates.dropMenu.replace("{content}",b))}},foreColor:{title:"前景色",type:"dropPanel",cssClass:"icon-wangEditor-pencil",style:"color:blue;",command:"foreColor",dropPanel:function(){var b,c=[],d='<a href="#" commandValue="${value}" style="background-color:${color};" title="${txt}" class="forColorItem">&nbsp;</a>';return a.each(o.styleConfig.colorOptions,function(a,b){var e=d.replace("${value}",a).replace("${color}",a).replace("${txt}",b);c.push(o.htmlTemplates.dropPanel_floatItem.replace("{content}",e))}),b=a(o.htmlTemplates.dropPanel.replace("{content}",c.join("")))}},backgroundColor:{title:"背景色",type:"dropPanel",cssClass:"icon-wangEditor-brush",style:"color:red;",command:"backColor ",dropPanel:function(){var b,c=[],d='<a href="#" commandValue="${value}" style="background-color:${color};" title="${txt}" class="forColorItem">&nbsp;</a>';return a.each(o.styleConfig.colorOptions,function(a,b){var e=d.replace("${value}",a).replace("${color}",a).replace("${txt}",b);c.push(o.htmlTemplates.dropPanel_floatItem.replace("{content}",e))}),b=a(o.htmlTemplates.dropPanel.replace("{content}",c.join("")))}},removeFormat:{title:"清除格式",type:"btn",cssClass:"icon-wangEditor-eraser",command:"RemoveFormat "},unOrderedList:{title:"无序列表",type:"btn",cssClass:"icon-wangEditor-list-bullet",command:"InsertUnorderedList "},orderedList:{title:"有序列表",type:"btn",cssClass:"icon-wangEditor-list-numbered",command:"InsertOrderedList "},justifyLeft:{title:"左对齐",type:"btn",cssClass:"icon-wangEditor-align-left",command:"JustifyLeft "},justifyCenter:{title:"居中",type:"btn",cssClass:"icon-wangEditor-align-center",command:"JustifyCenter"},justifyRight:{title:"右对齐",type:"btn",cssClass:"icon-wangEditor-align-right",command:"JustifyRight "},createLink:{title:"插入链接",type:"modal",cssClass:"icon-wangEditor-link",modal:function(b){var c=o.getUniqeId(),d=o.getUniqeId(),e=o.getUniqeId(),f=o.getUniqeId(),g='<p>链接：<input id="'+c+'" type="text" style="width:300px;"/></p><p>标题：<input id="'+d+'" type="text" style="width:300px;"/></p><p>新窗口：<input id="'+e+'" type="checkbox" checked="checked"/></p><p><button id="'+f+'" type="button" class="wangEditor-modal-btn">插入链接</button></p>',h=a(o.htmlTemplates.modalSmall.replace("{content}",g));return h.find("#"+f).click(function(f){var g=a.trim(a("#"+c).val()),h=a.trim(a("#"+d).val()),i=a("#"+e).is(":checked"),j=function(){a("#"+c).val(""),a("#"+d).val("")};if(""!==g){if(o.filterXSSForUrl(g)===!1)return void alert("您的输入内容有不安全字符，请重新输入！");""!==h||i?b.command(f,"customCreateLink",{url:g,title:h,isBlank:i},j):b.command(f,"createLink",g,j)}}),h}},unLink:{title:"取消链接",type:"btn",cssClass:"icon-wangEditor-unlink",command:"unLink "},insertExpression:{title:"插入表情",type:"dropPanel",command:"insertImage",cssClass:"icon-wangEditor-happy",dropPanel:function(b){var c=o.expressionConfig,d=c.path,e=c.fileNames,f=(e[0],e[1]),g=c.ext,h=[],i=1;if(b.expressions)h=b.expressions;else for(;f>=i;i++)h.push(d+i+g);var j,k=[],l='<a href="#" commandValue="${value}">   <img src="${src}" expression="1"/></a>';return a.each(h,function(a,b){var c=l.replace("${value}",b).replace("${src}",b);k.push(o.htmlTemplates.dropPanel_floatItem.replace("{content}",c))}),j=a(o.htmlTemplates.dropPanelBig.replace("{content}",k.join("")))}},insertVideo:{title:"插入视频",type:"modal",cssClass:"icon-wangEditor-play",modal:function(b){var c=o.getUniqeId(),d=o.getUniqeId(),e=o.getUniqeId(),f=o.getUniqeId(),g=480,h=400,i='<p>地址：<input id="'+c+'" type="text" style="width:300px;"/></p><p>宽度：<input id="'+d+'" type="text" style="width:50px" value="'+g+'"/> px（像素）</p><p>高度：<input id="'+e+'" type="text" style="width:50px" value="'+h+'"/> px（像素） </p><p><button id="'+f+'" class="wangEditor-modal-btn">插入视频</button></p>',j=a(o.htmlTemplates.modalSmall.replace("{content}",i));return j.find("#"+f).click(function(f){var i,j=a.trim(a("#"+c).val()),k=+a("#"+d).val(),l=+a("#"+e).val(),m=function(){a("#"+c).val(""),a("#"+d).val(g),a("#"+e).val(h)};return o.filterXSSForUrl(j)===!1?void alert("您的输入内容有不安全字符，请重新输入！"):0!==j.indexOf("http://")&&0!==j.indexOf("https://")||-1===j.indexOf(".swf")?void alert("您输入的内容不符合要求"):(isNaN(k)&&(k=g),isNaN(l)&&(l=h),i=o.htmlTemplates.videoEmbed.replace("{src}",j).replace("{width}",k).replace("{height}",l),void b.command(f,"insertHTML",i,m))}),j}},insertHr:{title:"插入横线",type:"btn",cssClass:"icon-wangEditor-minus",command:"InsertHorizontalRule"},insertTable:{title:"插入表格",type:"modal",cssClass:"icon-wangEditor-table",modal:function(b){var c=o.getUniqeId(),d=o.getUniqeId(),e=o.getUniqeId(),f=o.getUniqeId(),g='<p>行数：<input id="'+c+'" type="text" value="3"/></p><p>列数：<input id="'+d+'" type="text" value="5"/></p><p>显示首行背景：<input id="'+e+'" type="checkbox" checked="checked"/></p><p><button id="'+f+'" class="wangEditor-modal-btn">插入表格</button></p>',h=a(o.htmlTemplates.modalSmall.replace("{content}",g));return h.find("#"+f).click(function(f){var g,h,i,j=a("#"+c).val(),k=""===j||isNaN(+j)?3:j,l=a("#"+d).val(),m=""===l||isNaN(+l)?5:l,n=a("#"+e).is(":checked"),o=function(){a("#"+c).val(""),a("#"+d).val("")},p="",q='<table border="1" bordercolor="#cccccc" cellpadding="0" cellspacing="0" style="border-collapse:collapse;" > ${content} </table>',r=[],s='<tr style="font-weight:bold;background-color:#f1f1f1;">${content}</tr>',t="<tr>${content}</tr>",u='<td style="min-width:100px;">&nbsp;</td>',v="<td>&nbsp;</td>";for(g=0;k>g;g++){for(i=[],h=0;m>h;h++)i.push(0===g?u:v);r.push(0===g&&n?s.replace("${content}",i.join("")):t.replace("${content}",i.join("")))}p=q.replace("${content}",r.join("")),b.command(f,"insertHTML",p,o)}),h}},webImage:{title:"网络图片",type:"modal",cssClass:"icon-wangEditor-picture",modal:function(b){var c=o.getUniqeId(),d=o.getUniqeId(),e=o.getUniqeId(),g='<p>网址：<input id="'+c+'" type="text" style="width:300px;"/></p><p>标题：<input id="'+d+'" type="text" style="width:300px;"/></p><p><button id="'+e+'" type="button" class="wangEditor-modal-btn">插入图片</button></p>',h=a(o.htmlTemplates.modalSmall.replace("{content}",g));return h.find("#"+e).click(function(e){var g=a.trim(a("#"+c).val()),h=a.trim(a("#"+d).val()),i=function(){a("#"+c).val(""),a("#"+d).val("")};if(g||(g=a.trim(f.getElementById(c).value),h=a.trim(f.getElementById(d).value)),""!==g){if(o.filterXSSForUrl(g)===!1)return void alert("您的输入内容有不安全字符，请重新输入！");""===h?b.command(e,"insertImage",g,i):b.command(e,"customeInsertImage",{url:g,title:h},i)}}),h}},uploadImg:{title:"上传图片",type:"modal",cssClass:"icon-wangEditor-file-image",modal:function(b){var c=b.uploadUrl,d="wangEditor_uploadImg",e="|.bmp|.jpg|.jpeg|.png|.gif|",g=o.getUniqeId(),h=o.getUniqeId(),i=o.getUniqeId(),j=o.getUniqeId(),k=o.getUniqeId(),l=o.getUniqeId(),m='<form id="'+g+'" method="post" enctype="multipart/form-data" target="'+l+'">   <p>选择文件：<input type="file" name="'+d+'" id="'+h+'"/></p>   <p>图片标题：<input type="text" id="'+i+'" style="width:250px;"/></p>   <p><button id="'+j+'" class="wangEditor-modal-btn">上传</button></p>   <span stype="color:red;" id="'+k+'"></span></form><iframe id="'+l+'" name="'+l+'" style="display:none;"></iframe>',n=a(o.htmlTemplates.modalSmall.replace("{content}",m));return n.find("#"+j).click(function(d){if(null==c||"string"!=typeof c)return void alert("未配置URL地址，不能上传图片");var j=a("#"+h).val();if(""===j)return void alert("请选择图片文件");var m=j.slice(j.lastIndexOf(".")-j.length);if(m="|"+m.toLowerCase()+"|",-1===e.indexOf(m))return void alert("选择的文件不是图片格式");var n=a(this),p=a("#"+k),q=a("#"+g),r=a("#"+i).val(),s=(f.getElementById(l),function(){a("#"+h).val(""),a("#"+i).val("")});window.wangEditor_uploadImgCallback=function(a){o.consoleLog("父页面的wangEditor_uploadImgCallback方法已经开始被调用！");var c,e,f;if(0===a.indexOf("ok|")){if(c=a.split("|"),e=c[1],o.consoleLog("wangEditor_uploadImgCallback方法成功获取到图片url："+e),2===c.length)""===r?b.command(d,"insertImage",e,s):b.command(d,"customeInsertImage",{url:e,title:r},s);else{if(3!==c.length)return void alert("hash格式错误："+a);f=c[2],o.consoleLog("wangEditor_uploadImgCallback方法成功获取到缩略图url："+f),b.command(d,"customeInsertImage",{url:f,link:e,title:r},s)}o.consoleLog("wangEditor_uploadImgCallback方法已经成功插入图片，弹出框也被关闭！")}else alert(a);window.wangEditor_uploadImgCallback=void 0},n.hide(),p.html("上传中...");try{q.attr("action",c),q.submit()}catch(t){alert(t.name+":"+t.message)}finally{n.show(),p.html(""),d.preventDefault()}}),n}},insertSimpleCode:{title:"插入代码",type:"modal",cssClass:"icon-wangEditor-terminal",modal:function(b){var c=o.getUniqeId(),d=o.getUniqeId(),e='<p>请输入代码：</p><div><textarea id="'+c+'" style="width:100%; height:100px;"></textarea></div><button id="'+d+'" class="wangEditor-modal-btn">插入</button>',f=a(o.htmlTemplates.modalSmall.replace("{content}",e));return f.find("#"+d).click(function(d){var e=a.trim(a("#"+c).val()),f=function(){a("#"+c).val("")};e&&""!==e&&(e=e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/\n/gm,"<br>").replace(/\s{1}/gm,"&nbsp;"),e=o.htmlTemplates.codePre.replace("{content}",e),b.command(d,"insertHTML",e,f))}),f}},insertLocation:{title:"插入位置",type:"modal",cssClass:"icon-wangEditor-location",modal:function(b){var c,d=o.getUniqeId(),e=o.getUniqeId(),g=o.getUniqeId(),h=o.getUniqeId(),i=o.getUniqeId(),j=o.getUniqeId(),k=o.getUniqeId(),l=' 城市：<input type="text" id="'+d+'" style="width:60px;"/>  位置：<input type="text" id="'+e+'"> <button class="wangEditor-modal-btn" id="'+g+'">搜索</button> <button class="wangEditor-modal-btn" id="'+h+'">清除位置</button> <div id="'+i+'" style="width:100%; height:220px; border:1px solid #ccc; margin:10px 0px;">地图加载中……</div> <button class="wangEditor-modal-btn" id="'+j+'">插入位置</button> <input type="checkbox" id="'+k+'"/>动态地图',m=a(o.htmlTemplates.modal.replace("{content}",l)),n=[];return window.baiduMapCallBack=function(){function b(b){var e=b.name;c.setCenter(e),a("#"+d).val(e)}c=new BMap.Map(i),c.centerAndZoom(new BMap.Point(116.404,39.915),11),c.addControl(new BMap.MapTypeControl),c.setCurrentCity("北京"),c.enableScrollWheelZoom(!0);var e=new BMap.LocalCity;e.get(b),c.addEventListener("click",function(a){var b=new BMap.Marker(new BMap.Point(a.point.lng,a.point.lat));c.addOverlay(b),b.enableDragging(),n.push(b)})},a(function(){var a="TVhjYjq1ICT2qqL5LdS8mwas",b=f.createElement("script");b.type="text/javascript",b.src="http://api.map.baidu.com/api?v=2.0&ak="+a+"&callback=baiduMapCallBack",f.body.appendChild(b)}),m.find("#"+g).click(function(b){var f,g,h=a.trim(a("#"+d).val()),i=a.trim(a("#"+e).val());""!==h&&(i&&""!==i||c.centerAndZoom(h,11),i&&""!==i&&(f=new BMap.Geocoder,f.getPoint(i,function(a){a?(c.centerAndZoom(a,13),g=new BMap.Marker(a),c.addOverlay(g),g.enableDragging(),n.push(g)):(alert("没有找到您输入的地址!"),c.centerAndZoom(h,11))},h)))}),m.find("#"+h).click(function(a){c.clearOverlays(),n=[]}),m.find("#"+j).click(function(d){var e,f,g,h=a("#"+k).is(":checked"),i=c.getCenter(),j=i.lng,l=i.lat,m=c.getZoom(),o=c.getSize(),p=o.width,q=o.height;if(f=h?"http://ueditor.baidu.com/ueditor/dialogs/map/show.html#":"http://api.map.baidu.com/staticimage?",f=f+"center="+j+","+l+"&zoom="+m+"&width="+p+"&height="+q,n.length>0&&(f+="&markers=",a.each(n,function(a,b){e=b.getPosition(),a>0&&(f+="|"),f=f+e.lng+","+e.lat})),h){if(n.length>1)return void alert("动态地图只能显示一个位置！");f+="&markerStyles=l,A",g='<iframe class="ueditor_baidumap" src="{src}" frameborder="0" width="'+p+'" height="'+q+'"></iframe>',g=g.replace("{src}",f),b.command(d,"insertHTML",g)}else b.command(d,"insertImage",f)}),m}},undo:{title:"撤销",type:"btn",hotKey:"ctrl+z",cssClass:"icon-wangEditor-ccw",command:"commonUndo"},redo:{title:"重复",type:"btn",cssClass:"icon-wangEditor-cw",command:"commonRedo"},viewSourceCode:{title:"查看源码",type:"modal",cssClass:"icon-wangEditor-code",modal:function(b){var c=o.getUniqeId(),d=o.getUniqeId(),e='<div><textarea style="width:100%; height:200px;" id="'+c+'"></textarea></div><button id="'+d+'" class="wangEditor-modal-btn">更新源码</button>',f=a(o.htmlTemplates.modalBig.replace("{content}",e));return a(function(){b.$btnContainer.find(".icon-wangEditor-code").parent().click(function(d){var e=b.html();e=o.replaceQuotes(e),a("#"+c).val(e)})}),f.find("#"+d).click(function(d){var e=a("#"+c).val();""===a.trim(e)&&(e="<p><br></p>"),b.command(d,"replaceSourceCode",e)}),f}},fullScreen:{title:"切换全屏",type:"btn",cssClass:"icon-wangEditor-enlarge2",command:"fullScreen"}},this.editorMenuConfig=[["viewSourceCode"],["fontFamily","fontSize"],["bold","underline","italic"],["setHead","foreColor","backgroundColor","removeFormat"],["unOrderedList","orderedList"],["justifyLeft","justifyCenter","justifyRight"],["createLink","unLink","insertExpression","insertVideo"],["insertHr","insertTable","webImage","uploadImg","insertLocation","insertSimpleCode"],["undo","redo"],["fullScreen"]]}}),a.extend(o.fn,{getCommandBtns:function(){return null==this.$btnsWithCommandName&&(this.$btnsWithCommandName=this.$btnContainer.find("a[commandName]")),this.$btnsWithCommandName},updateMenuStyle:function(){var b=this.getCommandBtns();b.length<=0||b.each(function(){var b=a(this),c=a.trim(b.attr("commandName")).toLowerCase();"insertunorderedlist"!==c&&"insertorderedlist"!==c&&(o.commandEnabled(c)&&f.queryCommandState(c)?b.addClass("wangEditor-btn-container-btn-selected"):b.removeClass("wangEditor-btn-container-btn-selected"))})}}),a.extend(o.fn,{parentElemForCurrentRange:function(a){return a?void(this.parentElem=a):this.parentElem},currentRange:function(a){return a?void(this.currentRangeData=a):this.currentRangeData},saveSelection:function(b){var c,d,e=this,g=e.$txt[0];h?b?d=b.commonAncestorContainer:(c=f.getSelection(),c.getRangeAt&&c.rangeCount&&(b=f.getSelection().getRangeAt(0),d=b.commonAncestorContainer)):(b=f.selection.createRange(),d="undefined"==typeof b.parentElement?null:b.parentElement()),d&&(a.contains(g,d)||g===d)&&(e.parentElemForCurrentRange(d),e.currentRange(b))},restoreSelection:function(){var a,b,c=this,d=c.currentRange();d&&(h?(a=f.getSelection(),a.removeAllRanges(),a.addRange(d)):(b=f.selection.createRange(),b.setEndPoint("EndToEnd",d),0===d.text.length?b.collapse(!1):b.setEndPoint("StartToStart",d),b.select()))},initSelection:function(){var a,b=this,c=b.$txt.get(0);b.currentRange()||(h&&(a=f.createRange(),a.setStart(c,0),a.setEnd(c,0)),a&&b.saveSelection(a))}}),a.extend(o.fn,{change:function(){var a=this,b=a.html();(b.length!==a.latestHtml.length||b!==a.latestHtml)&&(b=o.replaceQuotes(b),o.showTableBorder(this.$txt),a.textareaVal(b),a.onchange&&a.onchange(b),a.latestHtml=b)}}),a.extend(o.fn,{_initCommandRecord:function(){var a=this,b=a.html();a.commandRecords=[],a.commandRecords.push(b),a.commandRecordCursor=0},addCommandRecord:function(){var a=this,b=a.commandRecords.length,c=a.html();b>0&&c===a.commandRecords[a.commandRecordCursor]||(a.commandRecords.push(c),b>=m&&a.commandRecords.shift(),b=a.commandRecords.length,a.commandRecordCursor=b-1)},undo:function(){this.commandRecordCursor>0&&(this.commandRecordCursor=this.commandRecordCursor-1,this.html(this.commandRecords[this.commandRecordCursor]))},redo:function(){var a=this,b=a.commandRecords.length;a.commandRecordCursor<b-1&&(a.commandRecordCursor=a.commandRecordCursor+1,a.html(a.commandRecords[a.commandRecordCursor]))}}),a.extend(o.fn,{commandHooks:{insertHTML:function(b,c){var d,e=this.currentRange(),f=this.parentElemForCurrentRange();e&&(d=o.getElemForInsertTable(a(f)),0===d.next().length&&(c+="<p><br/></p>"),d.after(a(c)))},customCreateLink:function(a,b){var c,d,e=b.url,g=b.title,h=b.isBlank,i=o.getUniqeId();c=this.$txt.find("a"),c.length>0&&c.attr(i,"1"),f.execCommand("createLink",!1,e),d=this.$txt.find("a").not("["+i+"]"),g&&d.attr("title",g),h&&d.attr("target","_blank"),c.length>0&&c.removeAttr(i)},customeInsertImage:function(a,b){var c,d,e=b.url,g=b.title,h=b.link,i=o.getUniqeId();c=this.$txt.find("img"),c.length>0&&c.attr(i,"1"),
f.execCommand("insertImage",!1,e),d=this.$txt.find("img").not("["+i+"]"),d.attr("title",g),d.attr("alt",g),h&&"string"==typeof h&&d.wrap('<a href="'+h+'" target="_blank"></a>'),c.length>0&&c.removeAttr(i)},delete$elem:function(a,b){b.remove()},commonUndo:function(a,b){this.undo(a,b)},commonRedo:function(a,b){this.redo(a,b)},replaceSourceCode:function(a,b){this.html(b)},fullScreen:function(a,b){var c=this.$txtContainer,d=this.getEditorContainer(),e=d.css("position"),f="icon-wangEditor-enlarge2",g="icon-wangEditor-shrink2",h=d.find("."+f),i=d.find("."+g);h.length?h.removeClass(f).addClass(g):i.length&&i.removeClass(g).addClass(f),"fixed"!==e?(this._txtContainerHeight=c.height(),c.css({height:"90%"}),d.css({position:"fixed",top:25,left:20,right:20,bottom:20,"z-index":1e3,"-webkit-box-shadow":"0 0 15px #CCC","-moz-box-shadow":"0 0 15px #CCC","box-shadow":"0 0 15px #CCC"})):(c.height(this._txtContainerHeight),d.css({position:"relative",top:0,left:0,right:0,bottom:0,"z-index":0,"-webkit-box-shadow":"0 0 0 #CCC","-moz-box-shadow":"0 0 0 #CCC","box-shadow":"0 0 0 #CCC"}))}},command:function(a,b,c,d){if(this.currentRange()){var e;this.restoreSelection(),o.commandEnabled(b)===!0?("insertHTML"===b&&(c+="<p><br/></p>"),f.execCommand(b,!1,c)):(e=this.commandHooks[b],e?e.call(this,b,c):o.consoleLog("不支持“"+b+"”命令，请检查。")),this.saveSelection(),d&&"function"==typeof d&&d(this),this.updateMenuStyle(),this.addCommandRecord(),this.change()}else alert("未选中编辑区，无法执行操作");this.hideModal(),a&&a.preventDefault()}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},Array.prototype.lastIndexOf=function(a){var b=this.length;for(b-=1;b>=0;b--)if(this[b]===a)return b;return-1}),a.fn.extend({wangEditor:function(a){if("TEXTAREA"!==this[0].nodeName)return void alert("wangEditor提示：请使用textarea扩展富文本框。详情可参见作者的demo.html");if(this.data("wangEditorFlag"))return void alert("针对一个textarea不能执行两遍wangEditor()事件");this.data("wangEditorFlag",!0),a=a||{};var b=o(this,a);return this.before(b.$editorContainer),this.hide(),b.initSelection(),b}})});